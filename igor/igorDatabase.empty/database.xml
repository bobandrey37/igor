<?xml version="1.0" ?>
<data>
	<environment>
		<night/>
		<location/>
		<energy/>
		<weather/>
		<messages/>
		<devices/>
		<lights/>
		<systemHealth>
			<messages/>
		</systemHealth>
		<introspection>
			<lastActivity/>
			<rebootCount>0</rebootCount>
		</introspection>
	</environment>
	<status>
		<igor/>
		<sensors/>
		<devices/>
		<services/>
	</status>
	<sensors/>
	<devices>
	</devices>
	<services>
		<igor/>
	</services>
	<people/>
	<identities/>
	<actions>
	    <action>
	        <name>start</name>
	        <url>/internal/started</url>
	    </action>
		<action>
			<name>rebooted</name>
            <xpath>/data/services/igor/startTime</xpath>
            <url>/data/environment/introspection/lastActivity/reboot</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>{igor_dateTime(.)}</data>
		</action>
		<action>
			<name>rebooted</name>
            <xpath>/data/services/igor/startTime</xpath>
            <url>/data/environment/introspection/rebootCount</url>
            <method>PUT</method>
            <mimetype>text/plain</mimetype>
            <data>{number(/data/environment/introspection/rebootCount)+1}</data>
		</action>
		<action>
			<name>save</name>
			<interval>3600</interval>
			<minInterval>60</minInterval>
			<url>/internal/save</url>
			<representing>igor/save</representing>
			<xpath>/data/plugindata//* | /data/actions/* | /data/triggers/* | /data/identities//* | /data/sandbox/*</xpath>
		</action>
        <action>
            <name>cleanup</name>
            <method>DELETE</method>
            <url>/data/environment/messages/message[position()&lt;last()]</url>
        </action>
		<action>
			<name>updateActions</name>
			<xpath>/data/actions/*</xpath>
			<url>/internal/updateActions</url>
		</action>
		<action>
			<name>checkNight</name>
			<interval>900</interval>
			<method>PUT</method>
			<url>/data/environment/night</url>
			<mimetype>text/plain</mimetype>
			<data>{igor_hours_from_dateTime(igor_dateTime()) &lt; 8 or igor_hours_from_dateTime(igor_dateTime()) &gt;= 23}</data>
		</action>
		<action>
			<name>updatePeople</name>
			<xpath>/data/environment/devices/*</xpath>
			<condition>/data/identities/*[device=name($originalContext)]</condition>
			<url>
			/data/people/{name(/data/identities/*[device=name($originalContext)])}/home
			</url>
			<method>PUT</method>
			<mimetype>text/plain</mimetype>
			<data>{.}</data>
			<multiple>true</multiple>
		</action>
		<action>
			<name>updateIgor</name>
			<interval>60</interval>
			<url>/data/environment/introspection/lastActivity/igor</url>
			<method>PUT</method>
			<mimetype>text/plain</mimetype>
			<data>{igor_dateTime()}</data>
		</action>
	</actions>
	<sandbox/>
	<eventsources/>
	<plugindata/>
</data>
