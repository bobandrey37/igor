<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Igor Plugins</title>
	<style>
	table, th, td {
		border: 1px solid black;
		border-collapse: collapse;
	}
	</style>
</head>
<body>
	{% if action == 'list' or not action %}
		<h1>Igor Plugins</h1>
		{% set user = igor.app.getSessionItem('user', None) %}
		{% if user %}
			<p>
				You are logged in as {{user}}.
				{% if user != 'admin' %}
					You may not have sufficient permissions for the commands below unless you login as user <i>admin</i>.
				{% endif %}
			</p>
		{% else %}
			<p>
				You are not logged in. This page will probably not render correctly.
			</p>
		{% endif %}
		
		<h2>Installed Igor Plugins</h2>
		
		<table style="width:100%">
			<tr>
				<th>Plugin</th>
				<th>Standard Plugin?</th>
				<th>Documentation</th>
				<th>Pages</th>
				<th>Plugin data (global)</th>
				<th>Plugin data (per-user)</th>
				<th>Action</th>
			</tr>
			{% for pluginName in igor.plugins.list(token) %}
				{% set pluginData = igor.plugins.info(pluginName, token) %}
				<tr>
					<td>{{pluginName}}</td>
					<td>{{pluginData.get('stdName', '')}}</td>
					<td>
						{% if 'doc' in pluginData %}
							<a href="{{pluginData.doc}}">readme.md</a>
						{% endif %}
					</td>
					<td>
						{% for page in pluginData.pages %}
							<a href="{{page}}">{{page.split('/')[-1]}}</a><br>
						{% endfor %}
					</td>
					<td>
						{{pluginData.get('pluginData', '')}}
					</td>
					<td>
						{{pluginData.get('userData', '')}}
					</td>
					<td>
						<form action="/plugins.html">
							<input type="hidden" name="action" value="delete">
							<input type="hidden" name="pluginName" value="{{pluginName}}">
							<input type="submit" value="Remove">
						</form>
					</td>
				</tr>
			{% endfor %}
		</table>
		
		<h2>Available Standard Igor Plugins</h2>
		
		<ul>
			{% for pluginName in igor.plugins.liststd(token) %}
				<li>{{pluginName}}</li>
			{% endfor %}
		</ul>
		
		<h2>Add Standard Plugin</h2>
		<form action="/plugins.html">
			<input type="hidden" name="action" value="addstd">
			Standard plugin to install:<br>
			<select name="stdName">
				{% for stdName in igor.plugins.liststd(token) %}
					<option value="{{stdName}}">{{stdName}}</option>
				{% endfor %}
			</select><br>
			Plugin Name (default: standard name)<br>
			<input type="text" name="pluginName"><br>
			<input type="submit" value="Add">
		</form>
		
		<h2>Add Plugin</h2>
		
		<p>Not yet implemented</p>
		
	{% elif action == 'delete' %}
		<p>{{igor.plugins.uninstall(pluginName, token)}}</p>
		<p><a href="/plugins.html">Return to plugin listing</a>
		
	{% elif action == 'addstd' %}
		<p>{{igor.plugins.installstd(pluginName if pluginName else stdName, stdName, token)}}</p>
		<p><a href="/plugins.html">Return to plugin listing</a>
		
	{% endif %}
</body>
</html>
